# Домашнее задание по курсу System Design ([balun.courses](https://balun.courses/courses/system_design))

## System Design проекта "Социальная сеть для путешественников".

### Содержание

1. [Требования](#требования)
   1. [Функциональные](#функциональные)
   2. [Нефункциональные](#нефункциональные)
2. [Расчет нагрузки](#расчет-нагрузки)

### Требования

#### Функциональные

* Аккаунт/профиль путешественника
  * Регистрация
  * Аутентификация (по уникальному логину / по почте / по номеру телефона / OAuth 2.0)
  * Авторизация
    * Например, могу редактировать только свои посты
  * Заполнение информации о себе
    * Ник  
    * Имя (отображаемое, полное)
    * Какое-то описание (н-р, любимые места для путешествия, способы передвижения и т.д.)
    * Аватарка
    * Местонахождение (страна, город)
* Публикация поста
  * Содержимое поста
    * Заголовок
    * Описание
    * Фотографии
    * Страна
    * Город
* Действия пользователей над опубликованными постами
  * Просмотр
    * Счетчик просмотров постов
  * Оценки
    * лайк/дизлайк
  * Комментарии
    * Содержимое комментария - только текст
    * Упорядочены по дате написания коммента (от старых к новым)
    * Структура комментариев - плоская
    * Если пользователь отвечает на чей-то комментарий, то будет приходить уведомление тому, на чей комментарий был ответ
* Подписка на путешественника
  * Уведомление при публикации поста подписчикам
  * Просмотр тех, на кого ты подписан
    * Сортировка - по имени
  * Просмотр тех, кто подписаны на тебя
    * Сортировка - по имени
* Лента постов
  * Отображает пост в виде превью (с возможностью перейти к просмотру поста целиком)
  * Сжатие фотографий (или обложки поста в виде фотки) для превью
  * Упорядочена по дате публикации поста (от новых к старым)
  * Отображает оценки каждого поста
* Поиск популярных мест
  * Популярность определяется по количеству постов об этом месте
  * Определяются ТОП по странам и ТОП по городам
  * В рамках каждой позиции ТОПа можно просмотреть самые популярные посты
* Общение в ЛС
  * Поиск/выбор собеседника
    * Поиск по нику
    * Выбор среди подписчиков / среди тех, на кого ты подписан
  * Просмотр собеседников (сначала те, с кем общался недавно)
  * Просмотр истории сообщений с собеседником
  * Отправить сообщение (текст)
    * Приложить фото к сообщению
  * Просмотр всех приложенных фото в рамках переписки с конкретным собеседником
  * Уведомление о новом сообщении
  * Поиск по истории сообщений (по текстам сообщений)

#### Нефункциональные
* Общее
  * 10 000 000 DAU, но будет расти, так что имеет смысл целиться сразу на 15 000 000 DAU
  * Регионы использования: Только СНГ
  * Доступность: 99.99%
  * Сезонность:
    * Больше пользователей просматривают посты в поисках места прямо перед сезонами путешествий (лето, новогодние праздники, длинные выходные)
* Аккаунт/профиль путешественника
  * Предположения:
    * Новых пользователей в день: 15 000 000 (DAU) / 365 = ~40 000 
    * Информация/поля в аккаунте с предполагаемым весом:
      * Ник (30b)
      * Имя (50b)
      * Пароль (100b)
      * Описание (200b)
      * Аватарка (1Mb)
      * Местонахождение (страна, город) (16b)
      * Итого: В среднем = ~1Mb
* Публикация поста
  * Содержимое поста
    * Заголовок (100b)
    * Описание: Максимум = 500Kb; В среднем = 50Kb
    * Фотографии
      * Максимальное кол-во = 20. В среднем = 5
      * Максимальный размер фото = 2Mb. В среднем = 1Mb
      * Итого: Максимум = 40Mb; В среднем = 5Mb
    * Страна (8b)
    * Город (8b)
    * Итого: В среднем = ~5Mb
  * Пользователь в среднем пишет 3 поста в месяц
* Действия пользователей над опубликованными постами
  * Пользователь в среднем просматривает/прочитывает 15 полных постов в день
  * Пользователь в среднем оценивает 10 постов в день
    * Вес "оценки": user_id(8b) + post_id(8b) + like(true/false=1b); с запасом ~30b 
  * Пользователь в среднем оставляет 5 комментов в день
    * Вес комментария: Максимум = 500b, в среднем = 200b
* Подписка на путешественника
  * Не более 1 000 000 подписчиков
  * В среднем новых подписок в день: 15 000 000 (DAU) * 0.1 = 1 500 000
* Лента постов
  * Пользователь в среднем просматривает ленту у 10 путешественников
  * Пусть один "подгружаемый кусок" ленты имеет 10 постов
  * Пусть один "подгружаемый кусок" весит в среднем ~2Mb (показываем превью постов, а не целиком)
  * Пользователь в среднем просматривает у каждого из 10 путешественников по 2 "подгружаемых куска"
* Поиск популярных мест
  * Пользователь в среднем просматривает ТОП 1 раз в день
* Общение в ЛС
  * Размер сообщения:
    * Фото: Максимум = 2Mb. В среднем = 1Mb
    * Текст: Максимум = 100Kb. В среднем = 100b
    * Итого: Максимум = 2.1Mb. В среднем = ~1Mb
  * Пользователь в среднем пишет 20 сообщений в день, из них 5 с фото
  * Пользователь в среднем просматривает диалоги 20 раз в день
  * Пользователь в среднем ищет (поиском по текстам сообщений) по истории сообщений 3 раза в день

### Расчет нагрузки
Аккаунт/профиль путешественника:
```
RPS по регистрации новых аккаунтов = 40 000 / 86 400 = 0.5 => ~1
Трафик по регистрации новых аккаунтов = 1 * 1Mb = 1Mb/sec
Прирост в год по памяти на новые аккаунты: 1Mb/sec * 86 400 * 365 = ~30Tb/year
```
Публикация поста:
```
RPS опубликовать новый пост = (15 000 000 * 3 / 30) / 86 400  = ~18
Трафик по публикации новых постов = 18 * 5Mb = ~90Mb/sec
Прирост в год по памяти на посты: 90Mb/sec * 86 400 * 365 = ~2 700Tb/year
```
Действия пользователей над опубликованными постами:
```
RPS по просмотру постов = (15 000 000 * 15) / 86 400 = ~2 600
Трафик по просмотру постов = 2 600 * 6Mb = ~15Gb/sec

RPS оценить пост (лайк/дизлайк) = (15 000 000 * 10) / 86 400 = 1 740
Трафик по оценкам постов = 1 740 * 30b = ~50Kb/sec
Прирост в год по оценкам постов = 50Kb/sec * 86 400 * 365 = 1.5Tb/year

RPS по новым комментариям = (15 000 000 * 5) / 86 400 = ~860
Трафик по новым комментариям = 860 * 200b = ~170Kb/sec
Прирост в год по новым комментариям = 170Kb/sec * 86 400 * 365 = 5Tb/year
```
Подписка на путешественника
```
RPS подписаться на путешественника = 1 500 000 / 86 400 = ~18
```
Лента постов
```
RPS просмотреть ленту = (15 000 000 * 10 * 2) / 86 400 = ~3 500
Трафик по просмотру лент = 3 500 * 2Mb = ~7Gb/sec
```
Общение в ЛС (? по приросту в год)
```
RPS по отправке сообщений = (15 000 000 * 20) / 86 400 = ~3 500
Трафик по отправке сообщений = (3 500 * (5/20) * 1Mb) + (3 500 * (15/20) * 100b) = 870Mb + 0.25Mb = ~870Mb/sec
Прирост в год по новым сообщениям = 870Mb/sec * 86 400 * 365 = ~26 000 Tb/year ??? чет очень много как будто
```