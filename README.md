# Домашнее задание по курсу System Design ([balun.courses](https://balun.courses/courses/system_design))

## System Design проекта "Социальная сеть для путешественников".

### Содержание

1. [Требования](#требования)
   1. [Функциональные](#функциональные)
   2. [Нефункциональные](#нефункциональные)
2. [Расчет нагрузки](#расчет-нагрузки)

### Требования

#### Функциональные

* Аккаунт/профиль путешественника
  * Регистрация
  * Аутентификация (по уникальному логину / по почте / по номеру телефона / OAuth 2.0)
  * Авторизация
    * Например, могу редактировать только свои посты
  * Заполнение информации о себе
    * Ник  
    * Имя (отображаемое, полное)
    * Какое-то описание (н-р, любимые места для путешествия, способы передвижения и т.д.)
    * Аватарка
    * Местонахождение (страна, город)
* Публикация поста
  * Содержимое поста
    * Заголовок
    * Описание
    * Фотографии
    * Страна
    * Город
  * (?) Возможность сохранить и просмотреть черновик перед публикацией
  * (?) Упомянуть (тегнуть) пользователя, будет приходить уведомление тому кого тегнули
* Фидбэк на пост
  * Оценки, но какого вида?
    * лайк/дизлайк
    * 10-балльная шкала
  * Комментарии
    * (?) Упомянуть (тегнуть) пользователя в комментарии, будет приходить уведомление тому кого тегнули
    * (?) Упорядочены по
      * дате написания коммента (от новых к старым)
    * (?) Варианты структуры
      * Плоская
      * Можно отвечать на комментарий (древовидная)
  * (?) Счетчик просмотров
* Подписка на путешественника
  * (?) Уведомление при публикации поста подписчикам
  * Просмотр тех, на кого ты подписан
    * * Сортировка? (по популярности / по активности)
  * Просмотр тех, кто подписаны на тебя
    * Сортировка? (по популярности / по активности)
  * (?) Отписать человека от себя
* Лента постов
  * (?) Отображает пост в виде превью (с возможностью перейти к просмотру поста целиком)
  * (?) Сжатие фотографий (или обложки поста в виде фотки) для превью
  * (?) Упорядочена по
    * дате публикации поста (от новых к старым)
    * популярности
  * Отображает оценки каждого поста
* Поиск популярных мест
  * (?) Популярность определяется по количеству постов об этом месте
  * (?) Определяются ТОП по странам и ТОП по городам
  * В рамках каждой позиции ТОПа можно просмотреть самые популярные посты
* Общение в ЛС
  * Поиск/выбор собеседника (по нику / среди подписчиков) 
  * Просмотр собеседников (сначала те, с кем общался недавно)
  * Просмотр истории сообщений с собеседником
  * (?) Приложить фото к сообщению
    * (?) Если да, то просмотр всех приложенных фото в рамках переписки
  * (?) Поиск по истории сообщений (по текстам сообщений)
  * (?) Удаление сообщений (только у себя / у обоих)
  * (?) Уведомление о новом сообщении
  * (?) Запинить (pin) сообщение
  * (?) Групповые чаты

#### Нефункциональные
* Общее
  * 10 000 000 DAU, но будет расти, (?) имеет смысл целиться сразу на 15 000 000 DAU
  * Регионы использования: Только СНГ
  * Доступность: 99.99%
  * Сезонность: отсутствует
* Аккаунт/профиль путешественника
  * Предположения:
    * Новых пользователей в день: 15 000 000 (DAU) / 365 = ~40 000 
    * Информация/поля в аккаунте с предполагаемым весом:
      * Ник (30b)
      * Имя (50b)
      * (?) Пароль (100b)
      * Описание (200b)
      * Аватарка (1Mb)
      * Местонахождение (страна, город) (16b)
      * Итого: В среднем = ~1Mb
* Публикация поста
  * Содержимое поста
    * Заголовок (100b)
    * Описание: Максимум = 5Mb; В среднем = 1Mb
    * Фотографии
      * Максимальное кол-во = 20. В среднем = 5
      * Максимальный размер фото = 2Mb. В среднем = 1Mb
      * Итого: Максимум = 40Mb; В среднем = 5Mb
    * Страна (8b)
    * Город (8b)
    * Итого: В среднем = ~6Mb
  * Пользователь в среднем пишет 3 поста в месяц
* Фидбэк на пост
  * Пользователь в среднем просматривает/прочитывает 15 полных постов в день
  * Пользователь в среднем оценивает 10 постов в день
  * Пользователь в среднем оставляет 5 комментов в день
  * Вес комментария: Максимум = 500b, в среднем = 200b
* Подписка на путешественника
  * Не более 1 000 000 подписчиков
  * В среднем новых подписок в день: 15 000 000 (DAU) * 0.1 = 1 500 000
* Лента постов
  * Пользователь в среднем просматривает ленту у 10 путешественников
  * Пусть один "подгружаемый кусок" ленты имеет 10 постов
  * Пусть один "подгружаемый кусок" весит в среднем ~2Mb (показываем превью постов, а не целиком)
  * Пользователь в среднем просматривает у каждого из 10 путешественников по 2 "подгружаемых куска"
* Поиск популярных мест
  * Пользователь в среднем просматривает ТОП 1 раз в день
* Общение в ЛС
  * Размер сообщения:
    * Фото: Максимум = 2Mb. В среднем = 1Mb
    * Текст: Максимум = 1Mb. В среднем = 100b
    * Итого: Максимум = 3Mb. В среднем = 1.1Mb
  * Пользователь в среднем пишет 20 сообщений в день, из них 5 с фото
  * Пользователь в среднем просматривает диалоги 20 раз в день
  * Пользователь в среднем ищет (поиском по текстам сообщений) по истории сообщений 3 раза в день

### Расчет нагрузки
Аккаунт/профиль путешественника:
```
RPS по регистрации новых аккаунтов = 40 000 / 86 400 = 0.5 => ~1
Трафик по регистрации новых аккаунтв = 1 * 1Mb = 1Mb/sec
Прирост в год по памяти на новые аккаунты: 1Mb/sec * 86 400 * 365 = ~30Tb/year
```
Публикация поста:
```
RPS по новым постам = (15 000 000 * 3 / 30) / 86 400  = ~18
Трафик по новым постам = 18 * 6Mb = ~100Mb/sec
Прирост в год по памяти на новые посты: 100Mb/sec * 86 400 * 365 = ~3 000Tb/year
```
Фидбэк на пост:
```
RPS по просмотру постов = (15 000 000 * 15) / 86 400 = ~2 600
Траффик по просмотру постов = 2 600 * 6Mb = ~15Gb/sec

RPS по новым комментариям = (15 000 000 * 5) / 86 400 = ~860
Траффик по новым комментариям = 860 * 200b = ~170Kb/sec
Прирост в год по новым комментариям = 170Kb/sec * 86 400 * 365 = 5Tb/year
```
Подписка на путешественника
```
RPS подписаться на путешественника = 1 500 000 / 86 400 = ~18
```
Лента постов
```
RPS просмотреть ленту = (15 000 000 * 10 * 2) / 86 400 = ~3 500
Траффик по просмотру лент = 3 500 * 2Mb = ~7Gb/sec
```
Общение в ЛС (? по приросту в год)
```
RPS по отправке сообщений = (15 000 000 * 20) / 86 400 = ~3 500
Траффик по отправке сообщений = (3 500 * (5/20) * 1.1Mb) + (3 500 * (15/20) * 100b) = 960Mb + 0.25Mb = ~960Mb/sec
Прирост в год по новым сообщениям = 960Mb/sec * 86 400 * 365 = 30 000 Tb/year ??? чет очень много как будто
```